generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String   @id @default(uuid())
  name         String
  email        String   @unique
  passwordHash String   @map("password_hash")
  createdAt    DateTime @default(now()) @map("created_at")
  groups       Group[]

  @@map("users")
}

model Group {
  id        String   @id @default(uuid())
  name      String
  ownerId   String   @map("owner_id")
  createdAt DateTime @default(now()) @map("created_at")
  owner     User     @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  participants Participant[]
  expenses  Expense[]

  @@map("groups")
}

model Participant {
  id        String   @id @default(uuid())
  name      String
  color     String?
  groupId   String   @map("group_id")
  createdAt DateTime @default(now()) @map("created_at")

  group            Group          @relation(fields: [groupId], references: [id], onDelete: Cascade)
  paidExpenses     Expense[]      @relation("PayerExpenses")
  expenseSplits    ExpenseSplit[]

  @@unique([groupId, name])
  @@map("participants")
}

enum SplitMode {
  EQUAL
  CUSTOM
  PERCENTAGE
}

model Expense {
  id          String     @id @default(uuid())
  groupId     String     @map("group_id")
  payerId     String     @map("payer_id")
  amount      Int
  description String
  date        DateTime
  splitMode   SplitMode  @map("split_mode")
  createdAt   DateTime   @default(now()) @map("created_at")

  group       Group            @relation(fields: [groupId], references: [id], onDelete: Cascade)
  payer       Participant      @relation("PayerExpenses", fields: [payerId], references: [id])
  splits      ExpenseSplit[]

  @@map("expenses")
}

model ExpenseSplit {
  id            String   @id @default(uuid())
  expenseId     String   @map("expense_id")
  participantId String   @map("participant_id")
  shareAmount   Int      @map("share_amount")

  expense       Expense     @relation(fields: [expenseId], references: [id], onDelete: Cascade)
  participant   Participant @relation(fields: [participantId], references: [id])

  @@map("expense_splits")
}
